{% extends 'admin/movies.html' %}

{% block title %}All Users{% endblock title %}

{% block main %}

<h1 class="my-1 text-center">All Users</h1>
<a href="/admin/add_new_user" class="btn btn-success my-3">Add New User</a>
<div class="tableWrapper">
    <table id="moviesTable" class="table">
        <thead>
            <tr>
                <th scope="col">#</th>
                <th scope="col">User ID</th>
                <th scope="col">Level</th>
                <th scope="col">Name</th>
                <th scope="col">Phone</th>
                <th scope="col">Password</th>
                <th scope="col">Country</th>
                <th scope="col">Referals</th>
                <th scope="col">Overall Deposit</th>
                <th scope="col">Wallet Balance</th>
                <th scope="col">Experience Money</th>
                <th scope="col">Self Referal Code</th>
                <th scope="col">Joining Referal Code</th>
                <th scope="col">Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for user in usersList %}
            <tr>
                <td>{{ usersList.index(user) + 1 }}</td>
                <td>{{user.user_id}}</td>
                <td>{{user.level}}</td>
                <td>{{user.name}}</td>
                <td>{{user.phone}}</td>
                <td>{{user.password}}</td>
                <td>{{abbrev_to_country[user.country]}}</td>
                <td>{{user.overall_referals}}</td>
                <td>{{user.overall_deposit}}</td>
                <td>{{round(user.wallet_balance, 2)}}</td>

                {% if user.experience_money == None %}
                <td>Expired</td>
                {% else %}
                <td>{{round(user.experience_money, 2)}}</td>
                {% endif %}
                
                <td>{{user.selfReferalCode}}</td>
                <td>{{user.joiningReferalCode}}</td>
                <td style="display: flex; flex-direction: row; column-gap: 5px;">
                    <a href="/admin/add_wallet_balance/{{ user.user_id }}" class="btn btn-warning">Add Balance</a>
                    <a href="/admin/minus_wallet_balance/{{ user.user_id }}" class="btn btn-info">Deduct Balance</a>
                    <a href="/admin/delete_user/{{user.user_id}}" class="btn btn-danger userDelBtn">Delete User</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

{% endblock main %}

{% block js %}
<script>
    let userDelBtnList = document.querySelectorAll(".userDelBtn");

    userDelBtnList.forEach(delBtn => {
        delBtn.addEventListener('click', (e)=>{
            e.preventDefault();
            let confirmation = window.confirm(`Are you sure to delete this User ?`);
            if(confirmation){
                window.location.href = e.target.href;
            }
        })
    });
</script>
{% endblock js %}
</html>